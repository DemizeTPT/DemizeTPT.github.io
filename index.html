<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Is Shawn Working?</title>

<style>
:root {
  --bg: #0f1115;
  --card: #161a22;
  --text: #e6e9ef;
  --muted: #9aa4b2;
  --work: #b91c1c;   /* dark red */
  --off: #22c55e;    /* green */
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg);
  color: var(--text);
  display: flex;
  justify-content: center;
}

.container {
  width: 100%;
  max-width: 900px;
  padding: 24px;
}

.card {
  background: var(--card);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
}

h1 {
  margin: 0 0 8px 0;
  font-size: 2rem;
  user-select: none;
}

.status {
  font-size: 3rem;
  font-weight: 800;
}

.muted {
  color: var(--muted);
  margin-top: 6px;
}

.calendar-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

button {
  background: none;
  border: 1px solid #2a2f3a;
  color: var(--text);
  padding: 6px 12px;
  border-radius: 8px;
  cursor: pointer;
}

.calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 6px;
}

.day, .dow {
  text-align: center;
  padding: 10px 0;
  border-radius: 10px;
}

.dow {
  color: var(--muted);
  font-size: 0.85rem;
}

.day {
  cursor: pointer;
  background: #10131a;
  transition: background-color 0.35s ease, color 0.35s ease;
}

.day.work {
  background: rgba(185,28,28,0.35);
  color: #fecaca;
}

.day.off {
  background: rgba(34,197,94,0.35);
  color: #bbf7d0;
}

.day.today {
  outline: 2px solid #6366f1;
}

.edit-indicator {
  margin-top: 10px;
  color: #fbbf24;
  display: none;
}
</style>
</head>

<body>
<div class="container">

  <div class="card">
    <h1 id="title">Is Shawn Working Today?</h1>
    <div id="status" class="status"></div>
    <div id="nextOff" class="muted"></div>
    <div id="editIndicator" class="edit-indicator">Edit mode enabled</div>
  </div>

  <div class="card">
    <div class="calendar-header">
      <button id="prev">◀</button>
      <div id="monthLabel"></div>
      <button id="next">▶</button>
    </div>

    <div class="calendar" id="calendar"></div>
  </div>

</div>

<script>
/* ===== CONFIG ===== */
const BIN_ID = "6986b3c1d0ea881f40a70740";
const READ_KEY = "$2a$10$UytFdwRN.8RNtjdr.l7R.ufpmfLeKp4a8dNK2qILbhDTfzZZWR8M6";
const WRITE_KEY = "$2a$10$UytFdwRN.8RNtjdr.l7R.ufpmfLeKp4a8dNK2qILbhDTfzZZWR8M6";

/* ===== STATE ===== */
let overrides = {};
let editMode = false;
let viewDate = new Date();

/* ===== HELPERS ===== */
const fmt = d => d.toISOString().split("T")[0];

function isWorkDay(date) {
  const day = date.getDay();
  const start = new Date("2026-02-03"); // Tuesday worked
  const weeks = Math.floor((date - start) / (1000*60*60*24*7));
  const mondayWeek = weeks % 2 === 1;

  let working =
    day === 4 || // Thursday
    day === 0 || // Sunday
    day === 6 || // Saturday
    (day === 1 && mondayWeek) ||
    (day === 2 && !mondayWeek);

  const key = fmt(date);
  if (overrides[key] === "work") working = true;
  if (overrides[key] === "off") working = false;

  return working;
}

/* ===== LOAD / SAVE OVERRIDES ===== */
async function loadOverrides() {
  const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
    headers: { "X-Access-Key": READ_KEY }
  });
  const data = await res.json();
  overrides = data.record.overrides || {};
}

async function saveOverrides() {
  await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
    method: "PUT",
    headers: {
      "Content-Type": "application/json",
      "X-Access-Key": WRITE_KEY
    },
    body: JSON.stringify({ overrides })
  });
}

/* ===== STATUS ===== */
function renderStatus() {
  const today = new Date();
  const working = isWorkDay(today);
  document.getElementById("status").textContent =
    working ? "YES" : "NO";

  let next = new Date(today);
  do { next.setDate(next.getDate() + 1); }
  while (isWorkDay(next));

  document.getElementById("nextOff").textContent =
    "Next day off: " + next.toDateString();
}

/* ===== CALENDAR ===== */
function renderCalendar() {
  const cal = document.getElementById("calendar");
  cal.innerHTML = "";

  const year = viewDate.getFullYear();
  const month = viewDate.getMonth();
  document.getElementById("monthLabel").textContent =
    viewDate.toLocaleString("default", { month: "long", year: "numeric" });

  ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].forEach(d => {
    const el = document.createElement("div");
    el.className = "dow";
    el.textContent = d;
    cal.appendChild(el);
  });

  const first = new Date(year, month, 1);
  for (let i = 0; i < first.getDay(); i++)
    cal.appendChild(document.createElement("div"));

  const days = new Date(year, month + 1, 0).getDate();
  for (let d = 1; d <= days; d++) {
    const date = new Date(year, month, d);
    const key = fmt(date);
    const el = document.createElement("div");
    el.className = "day";
    el.textContent = d;

    if (isWorkDay(date)) el.classList.add("work");
    else el.classList.add("off");

    if (fmt(date) === fmt(new Date())) el.classList.add("today");

    el.onclick = async () => {
      if (!editMode) return;
      overrides[key] = overrides[key] === "work" ? "off" : "work";
      await saveOverrides();
      renderStatus();
      renderCalendar();
    };

    cal.appendChild(el);
  }
}

/* ===== SECRET EDIT MODE ===== */
const title = document.getElementById("title");
let holdTimer;

title.addEventListener("mousedown", () => {
  holdTimer = setTimeout(toggleEdit, 3000);
});
title.addEventListener("mouseup", () => clearTimeout(holdTimer));
title.addEventListener("touchstart", () => {
  holdTimer = setTimeout(toggleEdit, 3000);
});
title.addEventListener("touchend", () => clearTimeout(holdTimer));

function toggleEdit() {
  editMode = !editMode;
  document.getElementById("editIndicator").style.display =
    editMode ? "block" : "none";
}

/* ===== NAV ===== */
document.getElementById("prev").onclick = () => {
  viewDate.setMonth(viewDate.getMonth() - 1);
  renderCalendar();
};
document.getElementById("next").onclick = () => {
  viewDate.setMonth(viewDate.getMonth() + 1);
  renderCalendar();
};

/* ===== INIT ===== */
(async () => {
  await loadOverrides();
  renderStatus();
  renderCalendar();
})();
</script>
</body>
</html>
